<script>
var options = {
	template: '../lib/pair/imitate.html',
	id: 'generic_imitate',
	title: 'deviceClasses.doorbell.views.generic_imitate.title',
	body: 'deviceClasses.doorbell.views.generic_imitate.body',
	svg: '<?xml version="1.0" encoding="utf-8"?>\n<!-- Generator: Adobe Illustrator 20.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->\n<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t viewBox="0 0 145.29 317.98" style="enable-background:new 0 0 145.29 317.98;" xml:space="preserve" xmlns:pulse="-">\n<style type="text/css">\n\t.st0{fill-rule:evenodd;clip-rule:evenodd;fill:#1A1A18;}\n</style>\n<g>\n\t<path pulse:initial="true" pulse:state="1" class="st0" d="M41.13,224.99c0-17.41,14.11-31.52,31.52-31.52s31.52,14.11,31.52,31.52c0,17.41-14.11,31.52-31.52,31.52\n\t\tS41.13,242.4,41.13,224.99"/>\n</g>\n<g>\n\t<path d="M94.63,168.7H48.15c-3.77,0-6.84-3.07-6.84-6.84V28.08c0-3.77,3.07-6.84,6.84-6.84h46.48c3.77,0,6.84,3.07,6.84,6.84\n\t\tv133.78C101.47,165.63,98.4,168.7,94.63,168.7z M48.15,22.66c-2.99,0-5.42,2.43-5.42,5.42v133.78c0,2.99,2.43,5.42,5.42,5.42h46.48\n\t\tc2.99,0,5.42-2.43,5.42-5.42V28.08c0-2.99-2.43-5.42-5.42-5.42H48.15z"/>\n</g>\n<g>\n\t<path d="M92.17,162.57H50.6c-1.74,0-3.16-1.42-3.16-3.16V30.53c0-1.74,1.42-3.16,3.16-3.16h41.57c1.74,0,3.16,1.42,3.16,3.16V159.4\n\t\tC95.34,161.15,93.92,162.57,92.17,162.57z M50.6,28.79c-0.96,0-1.74,0.78-1.74,1.74V159.4c0,0.96,0.78,1.74,1.74,1.74h41.57\n\t\tc0.96,0,1.74-0.78,1.74-1.74V30.53c0-0.96-0.78-1.74-1.74-1.74H50.6z"/>\n</g>\n<g>\n\t<path d="M72.65,265.62c-22.4,0-40.63-18.23-40.63-40.63c0-22.4,18.23-40.63,40.63-40.63c22.4,0,40.63,18.23,40.63,40.63\n\t\tC113.27,247.4,95.05,265.62,72.65,265.62z M72.65,185.78c-21.62,0-39.21,17.59-39.21,39.21c0,21.62,17.59,39.21,39.21,39.21\n\t\tc21.62,0,39.21-17.59,39.21-39.21C111.86,203.37,94.27,185.78,72.65,185.78z"/>\n</g>\n<g>\n\t<path d="M72.65,257.22c-17.77,0-32.23-14.46-32.23-32.23c0-17.77,14.46-32.23,32.23-32.23c17.77,0,32.23,14.46,32.23,32.23\n\t\tC104.88,242.76,90.42,257.22,72.65,257.22z M72.65,194.18c-16.99,0-30.81,13.82-30.81,30.81s13.82,30.81,30.81,30.81\n\t\tc16.99,0,30.81-13.82,30.81-30.81S89.64,194.18,72.65,194.18z"/>\n</g>\n<path d="M145.14,43.01c0.12-2.93,0.25-6.25,0.07-9.08c-0.82-13.03-8.6-16.43-18.46-20.74l-1.6-0.7C110.53,6.05,88.66-0.3,72.76,0.01\n\tC56.73-0.31,34.77,6.05,20.14,12.49l-1.6,0.7C8.69,17.5,0.9,20.9,0.09,33.93c-0.18,2.83-0.05,6.15,0.07,9.08\n\tc0.05,1.37,0.11,2.69,0.12,3.88c0.49,35.41,0.76,71.4,0.8,106.96c-0.02,40.62-0.31,84.6-0.8,120.62\n\tC-0.33,291.16,5.6,302,18.41,307.58c14.8,6.45,37.1,10.72,54.24,10.38c0.64,0.01,1.28,0.02,1.93,0.02\n\tc16.85,0,38.05-4.18,52.31-10.39c12.81-5.58,18.74-16.42,18.13-33.09c-0.5-36.08-0.79-80.06-0.8-120.65\n\tc0.05-35.52,0.32-71.51,0.8-106.96C145.03,45.69,145.09,44.38,145.14,43.01z M2.92,34.1c0.71-11.3,7.1-14.09,16.76-18.32l1.6-0.7\n\tC35.62,8.77,57.11,2.52,72.76,2.85c15.56-0.31,36.92,5.92,51.26,12.24l1.6,0.7c9.67,4.23,16.05,7.02,16.76,18.32\n\tc0.17,2.69,0.05,5.79-0.07,8.8c-0.05,1.39-0.11,2.73-0.13,3.94c-0.49,35.46-0.76,71.46-0.8,107c0.01,35.37,0.24,73.31,0.62,106.39\n\tc-2,9.27-7.24,15.64-15.96,19.44c-14.33,6.24-36.78,10.55-53.38,10.2l-0.01,0.71l-0.01-0.71c-16.6,0.34-39.05-3.96-53.38-10.2\n\tc-8.73-3.8-13.97-10.2-15.96-19.48c0.38-33.03,0.61-70.96,0.62-106.35c-0.05-35.57-0.32-71.57-0.8-107\n\tc-0.02-1.21-0.07-2.55-0.13-3.95C2.87,39.89,2.75,36.79,2.92,34.1z M125.76,304.98c-14.25,6.21-36.55,10.47-53.08,10.14l-0.03,0\n\tl-0.03,0c-16.5,0.33-38.83-3.93-53.08-10.14c-11.62-5.06-16.99-15.01-16.43-30.45c0.04-3.07,0.08-6.22,0.12-9.41\n\tc2.7,7.29,7.8,12.51,15.46,15.84c14.72,6.42,36.91,10.65,53.96,10.32c0.64,0.01,1.28,0.02,1.94,0.02c16.76,0,37.85-4.16,52.02-10.33\n\tc7.67-3.34,12.76-8.57,15.46-15.87c0.04,3.2,0.08,6.37,0.12,9.46C142.75,289.97,137.38,299.92,125.76,304.98z"/>\n</svg>\n',
	svgWidth: '80vw',
	svgHeight: '70vh',
	initWithDeviceData: false,
	previous: true,
	next: false
};
Homey.setTitle(__(options.title || ''));
Homey.emit('init', options.id);
Homey.on('show_view', function(viewId){
	Homey.showView(viewId);
});
Homey.on('close', function(){
	Homey.close();
});
Homey.on('nextView', function(viewsIds){
	var viewIndex = viewsIds.indexOf(options.id) + 1;
	if(viewIndex > 0 && viewIndex < viewsIds.length){
		Homey.showView(viewsIds[viewIndex]);
	}
});
Homey.on('previousView', function(viewsIds){
	var viewIndex = viewsIds.indexOf(options.id) - 1;
	if(viewIndex >= 0){
		Homey.showView(viewsIds[viewIndex]);
	}
});
function nextView(){
	if(options.next){
		Homey.nextView();
	}else{
		Homey.emit('next');
	}
}
</script>

<link href="../../../assets/433_generator/css/styles.css" rel="stylesheet" type="text/css"/>

<link href="../../../assets/433_generator/css/svg.css" rel="stylesheet" type="text/css"/>

<script src="../../../assets/433_generator/js/svghighlighter.js" type="text/javascript"></script>

<div class="centered-container">
	<div id="image-container"></div>
	<div id="body"><span class="content"></span></div>
	<div class="foundAnimation" id="foundBackground" style="display:none;"></div>
	<i class="fa fa-check-circle foundAnimation" id="found" style="display:none;" aria-hidden="true"></i>
</div>

<script>
	var idPrefix = '[data-id="' + options.id + '"] ';
	$(idPrefix + '#body > span').html(__(options.body));
	var $imageContainer = $(idPrefix + '#image-container');
	$imageContainer.css('width', options.svgWidth).css('height', options.svgHeight);

	$imageContainer.html(options.svg);
	$imageContainer.highlight();

	var found = false;
	Homey.on('frame', function (data) {
		if(!found) {
			found = true;
			Homey.emit('set_device', data, function (err, device) {
				if (err) {
					if((err.message || err) !== '433_generator.error.invalid_device') {
						Homey.alert(err.message && err.message.indexOf(' ') === -1 && __(err.message) !== err.message ? __(err.message) : JSON.stringify(err));
					}
					found = false;
					return;
				}
				const dataKey = JSON.stringify(device.data);
				window.selected_devices = [ dataKey ];
				window.found_devices = {};
				window.found_devices[dataKey] = device;
				var $foundElems = $(idPrefix + '.foundAnimation');
				$foundElems.show();
				setTimeout(function () {
					$foundElems.addClass('fadeOut');
					setTimeout(nextView, 400);
				}, 500);
			});
		}
	});
</script>

<style>
	#found {
		z-index: 2;
		position: absolute;
		top: 20vh;
		left: 38vw;
		font-size: 30vh;
		color: #080;
		opacity: 1;
	}

	#foundBackground {
		z-index: 1;
		top: 0;
		bottom: 0;
		left: 0;
		right: 0;
		position: absolute;
		background-color: #FFF;
		opacity: 0.8;
	}

	.fadeOut {
		-webkit-transition: all 0.5s ease-in-out;
		-moz-transition: all 0.5s ease-in-out;
		-ms-transition: all 0.5s ease-in-out;
		-o-transition: all 0.5s ease-in-out;
		transition: all 0.5s ease-in-out;
		opacity: 0 !important;
	}
</style>