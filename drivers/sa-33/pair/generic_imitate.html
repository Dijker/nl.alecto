<script>
var options = {
	template: '../lib/pair/imitate.html',
	id: 'generic_imitate',
	svg: '<?xml version="1.0" encoding="utf-8"?>\n<!-- Generator: Adobe Illustrator 21.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->\n<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t viewBox="0 0 599.5 599.5" style="enable-background:new 0 0 599.5 599.5;" xml:space="preserve" xmlns:pulse="-">\n<g>\n\t<path fill="#FFFFFF" pulse:initial="true" d="M183.3,479.4c0.2,0,0.3-0.1,0.5-0.1l0,0l0,0l0.2,0c-0.3-0.3-0.5-0.6-0.7-0.9V479.4z M147.5,465.6h16\n\t\tc0.5,0,1,0.1,1.4,0.3c0.4-0.2,0.9-0.3,1.4-0.3c0.1,0,0.2,0,0.2,0l14.8,0c1.5,0,2.7,1.1,2.8,2.5c0.2-0.2,0.5-0.5,0.7-0.7\n\t\tc0.6-0.5,1.3-0.9,2.1-1.3l0.1,0l0,0c0.8-0.3,1.5-0.5,2.4-0.7c0.8-0.1,1.7-0.2,2.6-0.2c3.2,0,5.7,0.8,7.6,2.4l0.1,0.1l0,0l0.1,0.1\n\t\tc0.3-1.2,1.4-2.2,2.8-2.2h16c1.6,0,2.8,1.3,2.8,2.8v3.4c0,1.6-1.3,2.8-2.8,2.8h-3.1v14c0,1.6-1.3,2.8-2.8,2.8h-4.1\n\t\tc-1.6,0-2.8-1.3-2.8-2.8v-14h-3.1c-0.2,1-0.8,1.8-1.7,2.1c0.3,0.3,0.6,0.7,0.9,1.1l0.1,0.1l0,0c0.5,0.7,0.8,1.5,1,2.3\n\t\tc0.2,0.8,0.3,1.6,0.3,2.5c0,0.8-0.1,1.7-0.4,2.5c-0.2,0.8-0.6,1.6-1.1,2.3l0,0c-0.5,0.7-1.1,1.4-1.8,2c-0.7,0.6-1.4,1-2.2,1.3\n\t\tc-0.8,0.3-1.6,0.6-2.6,0.7c-0.9,0.2-1.8,0.3-2.8,0.3c-1.6,0-2.9-0.2-4.2-0.6c-1.4-0.4-2.6-1.1-3.5-2c-0.3,1.2-1.4,2.1-2.7,2.1\n\t\th-15.3c-1.6,0-2.8-1.3-2.8-2.8v-14h-3v14c0,1.6-1.3,2.8-2.8,2.8h-4.1c-1.6,0-2.8-1.3-2.8-2.8v-14h-3.1c-1.6,0-2.8-1.3-2.8-2.8v-3.4\n\t\tC144.7,466.9,146,465.6,147.5,465.6z M258.1,457.2c-22.3-8.2-40.5-13.6-55.6-16.8c-15.5-3.3-27.5-4.3-36.9-3.6\n\t\tc-8.9,0.7-15.2,2.9-19.9,6.2c-4.6,3.2-7.7,7.4-9.9,12.1c-1.7,3.5-2.7,7.3-2.9,11.2c-0.2,3.9,0.4,7.8,1.7,11.5\n\t\tc1.3,3.5,3.2,6.8,5.8,9.7c2.3,2.6,5.3,4.9,8.7,6.8h94L258.1,457.2z"/>\n</g>\n<g>\n\t<path d="M511.7,87.8C455.1,31.2,379.8,0,299.8,0c-80.1,0-155.3,31.2-212,87.8C31.2,144.4,0,219.7,0,299.8\n\t\tc0,80.1,31.2,155.3,87.8,212c56.6,56.6,131.9,87.8,212,87.8c80.1,0,155.3-31.2,212-87.8s87.8-131.9,87.8-212\n\t\tC599.5,219.7,568.3,144.4,511.7,87.8z M508.7,508.7c-55.8,55.8-130,86.6-209,86.6c-78.9,0-153.1-30.7-209-86.6\n\t\tc-55.8-55.8-86.6-130-86.6-209c0-78.9,30.7-153.1,86.6-209c55.8-55.8,130-86.6,209-86.6c78.9,0,153.1,30.7,209,86.6\n\t\tc55.8,55.8,86.6,130,86.6,209C595.3,378.7,564.5,452.9,508.7,508.7z"/>\n\t<path d="M490.3,109.3c-50.9-50.9-118.5-78.9-190.5-78.9c-72,0-139.6,28-190.5,78.9S30.4,227.8,30.4,299.8c0,72,28,139.6,78.9,190.5\n\t\ts118.5,78.9,190.5,78.9s139.6-28,190.5-78.9c50.9-50.9,78.9-118.5,78.9-190.5C569.2,227.8,541.1,160.2,490.3,109.3z M484.2,484.2\n\t\tc-49.3,49.3-114.8,76.4-184.5,76.4c-69.7,0-135.2-27.1-184.5-76.4S38.9,369.4,38.9,299.8c0-69.7,27.1-135.2,76.4-184.5\n\t\ts114.8-76.4,184.5-76.4c69.7,0,135.2,27.1,184.5,76.4s76.4,114.8,76.4,184.5C560.7,369.4,533.5,435,484.2,484.2z"/>\n\t<polygon points="362.8,468.5 358.7,468.5 358.7,488.7 373,488.7 373,485.3 362.8,485.3 \t"/>\n\t<polygon points="380.1,479.7 390.3,479.7 390.3,476.3 380.1,476.3 380.1,471.8 391.1,471.8 391.1,468.4 376,468.4 376,488.7\n\t\t391.4,488.7 391.4,485.3 380.1,485.3 \t"/>\n\t<path d="M400.7,468.4l-7.9,20.3h4.3l1.7-4.6h8.2l1.8,4.6h4.4l-8.2-20.3L400.7,468.4z M400.1,480.6l2.7-7.6l2.8,7.6H400.1z"/>\n\t<path d="M428.9,481.4c-0.6-0.6-1.2-1.1-2.2-1.7c1.7-0.3,3.1-1,4-1.9c0.9-0.9,1.4-2.3,1.4-3.7c0-1.1-0.3-2.3-0.9-3.2\n\t\tc-0.6-0.9-1.4-1.6-2.4-1.9c-1-0.3-2.6-0.6-4.8-0.6l-8.6,0v20.3v0.1h4.3v-8.5h0.8c0.9,0,1.6,0.1,2,0.2c0.5,0.1,0.9,0.3,1.2,0.8\n\t\tc0.3,0.3,1.1,1.4,2.2,2.9l2.9,4.4h4.9l-2.5-4C430.3,483.1,429.5,482,428.9,481.4z M422.6,477h-2.9v-5.2h3.2c1.6,0,2.6,0.1,2.9,0.1\n\t\tc0.7,0.1,1.2,0.3,1.6,0.8c0.3,0.5,0.6,1,0.6,1.7c0,0.6-0.2,1-0.5,1.5c-0.2,0.5-0.7,0.8-1.1,0.9C425.8,476.9,424.5,477,422.6,477z"\n\t\t/>\n\t<polygon points="448.2,482 439.9,468.4 436,468.4 436,488.7 439.8,488.7 439.8,475.4 448,488.7 452.1,488.7 452.1,468.4\n\t\t448.2,468.4 \t"/>\n\t<circle cx="492.8" cy="433.7" r="12.8"/>\n\t<polygon points="147.5,471.8 153.5,471.8 153.5,488.6 157.6,488.6 157.6,471.8 163.6,471.8 163.6,468.4 147.5,468.4 \t"/>\n\t<polygon points="181.3,471.8 181.3,468.4 166.3,468.4 166.3,488.6 181.6,488.6 181.6,485.3 170.3,485.3 170.3,479.7 180.5,479.7\n\t\t180.5,476.3 170.3,476.3 170.3,471.8 \t"/>\n\t<path d="M195.4,484.8c-0.7,0.6-1.6,0.8-2.9,0.8c-1.2,0-2.3-0.2-2.9-0.9c-0.8-0.7-1.2-1.6-1.5-2.9l-3.9,0.3c0.2,2.3,1,3.9,2.1,5.2\n\t\tc1.4,1.2,3.3,1.8,5.9,1.8c1.8,0,3.3-0.3,4.4-0.8c1.1-0.5,2-1.2,2.7-2.3c0.7-1,1-2.1,1-3.3c0-1.4-0.2-2.4-0.8-3.3\n\t\tc-0.6-0.8-1.4-1.6-2.3-2c-0.9-0.6-2.4-1-4.4-1.5c-1.9-0.5-3.2-0.9-3.7-1.4c-0.3-0.3-0.6-0.8-0.6-1.2c0-0.6,0.2-0.9,0.7-1.2\n\t\tc0.7-0.5,1.6-0.7,2.8-0.7c1.1,0,2,0.2,2.6,0.7c0.6,0.5,0.9,1.2,1.1,2.3l4.1-0.2c-0.1-1.8-0.8-3.3-2-4.4c-1.4-1.1-3.3-1.7-5.8-1.7\n\t\tc-1.6,0-2.8,0.2-3.9,0.7c-1,0.5-1.9,1.1-2.5,2c-0.6,0.9-0.9,1.9-0.9,2.9c0,1.6,0.7,2.9,1.9,4.1c0.9,0.8,2.5,1.5,4.6,2\n\t\tc1.7,0.5,2.8,0.8,3.3,0.9c0.7,0.2,1.2,0.6,1.5,0.9c0.3,0.3,0.5,0.8,0.5,1.2C196.4,483.6,196.1,484.2,195.4,484.8z"/>\n\t<polygon points="208.5,488.6 212.5,488.6 212.5,471.8 218.5,471.8 218.5,468.4 202.5,468.4 202.5,471.8 208.5,471.8 \t"/>\n\t<path d="M401.2,299.8c0-55.9-45.5-101.4-101.4-101.4s-101.4,45.5-101.4,101.4s45.5,101.4,101.4,101.4S401.2,355.7,401.2,299.8z\n\t\t M299.8,396.9c-53.6,0-97.2-43.6-97.2-97.2s43.6-97.2,97.2-97.2s97.2,43.6,97.2,97.2S353.3,396.9,299.8,396.9z"/>\n\t<path d="M334.1,452.4l-2,0.8l19.5,48.2h100.5l0.4-0.2c20.9-10.4,25.4-33.1,17.6-49.1C459.8,430.8,435.6,414.3,334.1,452.4z\n\t\t M451.1,497.1h-96.6l-16.8-41.5c96.5-35.9,119.2-21,128.6-1.8C473.1,467.9,469.2,487.8,451.1,497.1z"/>\n\t<circle cx="106.8" cy="433.7" r="12.8"/>\n\t<path d="M165.1,429.8c-20.8,1.6-30.2,10.9-35.7,22.2c-4.3,8.8-4.8,19-1.5,28.1c3.1,8.6,9.4,16.2,19.1,21l0.5,0.2h99h1.4l19.5-48.2\n\t\tl-2-0.8C216.2,434,185.2,428.2,165.1,429.8z M245.1,497.1h-96.6c-8.3-4.3-13.8-10.9-16.5-18.4c-2.9-8.1-2.5-17.1,1.3-24.8\n\t\tc4.9-10.1,13.4-18.4,32.2-19.8c19.3-1.5,49.1,4,96.4,21.6L245.1,497.1z"/>\n\t<path d="M240.7,131.6l82.1,47.4c0.7,0.4,1.4,0.6,2.1,0.6c1.5,0,2.9-0.8,3.7-2.1c1.2-2,0.5-4.6-1.6-5.8L245,124.2\n\t\tc-2-1.2-4.6-0.5-5.8,1.6S238.7,130.4,240.7,131.6z"/>\n\t<path d="M248.6,99.5l98.1,56.6c0.7,0.4,1.4,0.6,2.1,0.6c1.5,0,2.9-0.8,3.7-2.1c1.2-2,0.5-4.6-1.6-5.8l-98.1-56.6\n\t\tc-2-1.2-4.6-0.5-5.8,1.6C245.9,95.7,246.6,98.3,248.6,99.5z"/>\n\t<path d="M272.4,76.7l82.1,47.4c0.7,0.4,1.4,0.6,2.1,0.6c1.5,0,2.9-0.8,3.7-2.1c1.2-2,0.5-4.6-1.6-5.8l-82.1-47.4\n\t\tc-2-1.2-4.6-0.5-5.8,1.6C269.7,72.9,270.4,75.5,272.4,76.7z"/>\n\t<path d="M288.5,135.9c-0.5,0.9-0.7,2-0.4,3c0.3,1,0.9,1.9,1.8,2.4c0.6,0.4,1.3,0.5,1.9,0.5c1.4,0,2.7-0.7,3.4-2\n\t\tc1.1-1.9,0.4-4.3-1.4-5.3C291.9,133.4,289.5,134.1,288.5,135.9z"/>\n\t<path d="M271.8,121.8c-0.9-0.5-2-0.7-3-0.4c-1,0.3-1.9,0.9-2.4,1.8c-1.1,1.9-0.4,4.3,1.4,5.3c0.6,0.3,1.3,0.5,1.9,0.5\n\t\tc0.3,0,0.7,0,1-0.1c1-0.3,1.8-0.9,2.4-1.8c0.5-0.9,0.7-2,0.4-3S272.7,122.4,271.8,121.8z"/>\n\t<path d="M315.7,147.2c-1.9-1.1-4.3-0.4-5.3,1.4c-0.5,0.9-0.7,2-0.4,3c0.3,1,0.9,1.9,1.8,2.4c0.6,0.3,1.3,0.5,1.9,0.5\n\t\tc0.3,0,0.7,0,1-0.1c1-0.3,1.8-0.9,2.4-1.8c0.5-0.9,0.7-2,0.4-3C317.3,148.6,316.6,147.7,315.7,147.2z"/>\n\t<path d="M309.6,107c-0.9-0.5-2-0.7-3-0.4c-1,0.3-1.8,0.9-2.4,1.8c-0.5,0.9-0.7,2-0.4,3c0.3,1,0.9,1.8,1.8,2.4\n\t\tc0.6,0.3,1.3,0.5,1.9,0.5c0.3,0,0.7,0,1-0.1c1-0.3,1.8-0.9,2.4-1.8s0.7-2,0.4-3C311.2,108.4,310.5,107.6,309.6,107z"/>\n\t<path d="M284.7,94c-1,0.3-1.9,0.9-2.4,1.8s-0.7,2-0.4,3c0.3,1,0.9,1.9,1.8,2.4c0.6,0.3,1.3,0.5,1.9,0.5c0.3,0,0.7,0,1-0.1\n\t\tc1-0.3,1.9-0.9,2.4-1.8c1.1-1.9,0.4-4.3-1.4-5.3C286.8,93.8,285.7,93.7,284.7,94z"/>\n\t<path d="M331.6,119.7c-1.9-1.1-4.3-0.4-5.3,1.4c-0.5,0.9-0.7,2-0.4,3c0.3,1,0.9,1.9,1.8,2.4c0.6,0.3,1.3,0.5,1.9,0.5\n\t\tc0.3,0,0.7,0,1-0.1c1-0.3,1.8-0.9,2.4-1.8c0.5-0.9,0.7-2,0.4-3C333.2,121.1,332.5,120.2,331.6,119.7z"/>\n</g>\n\n</svg>\n',
	title: 'deviceClasses.smoke_sensor.views.generic_imitate.title',
	body: 'deviceClasses.smoke_sensor.views.generic_imitate.body',
	svgWidth: '80vw',
	svgHeight: '70vh',
	initWithDeviceData: false,
	previous: true,
	next: false
};
Homey.setTitle(__(options.title || ''));
Homey.emit('init', options.id);
Homey.on('show_view', function(viewId){
	Homey.showView(viewId);
});
Homey.on('close', function(){
	Homey.close();
});
Homey.on('nextView', function(viewsIds){
	var viewIndex = viewsIds.indexOf(options.id) + 1;
	if(viewIndex > 0 && viewIndex < viewsIds.length){
		Homey.showView(viewsIds[viewIndex]);
	}
});
Homey.on('previousView', function(viewsIds){
	var viewIndex = viewsIds.indexOf(options.id) - 1;
	if(viewIndex >= 0){
		Homey.showView(viewsIds[viewIndex]);
	}
});
function nextView(){
	if(options.next){
		Homey.nextView();
	}else{
		Homey.emit('next');
	}
}
</script>

<link href="../../../assets/433_generator/css/styles.css" rel="stylesheet" type="text/css"/>

<link href="../../../assets/433_generator/css/svg.css" rel="stylesheet" type="text/css"/>

<script src="../../../assets/433_generator/js/svghighlighter.js" type="text/javascript"></script>

<div class="centered-container">
	<div id="image-container"></div>
	<div id="body"><span class="content"></span></div>
	<div class="foundAnimation" id="foundBackground" style="display:none;"></div>
	<i class="fa fa-check-circle foundAnimation" id="found" style="display:none;" aria-hidden="true"></i>
</div>

<script>
	var idPrefix = '[data-id="' + options.id + '"] ';
	$(idPrefix + '#body > span').html(__(options.body));
	var $imageContainer = $(idPrefix + '#image-container');
	$imageContainer.css('width', options.svgWidth).css('height', options.svgHeight);

	$imageContainer.html(options.svg);
	$imageContainer.highlight();

	var found = false;
	Homey.on('frame', function (data) {
		console.log('GOT FRAME', data);
		if(!found) {
			found = true;
			Homey.emit('set_device', data, function (err, device) {
				if (err) {
					if((err.message || err) !== '433_generator.error.invalid_device') {
						Homey.alert(err.message && err.message.indexOf(' ') === -1 && __(err.message) !== err.message ? __(err.message) : JSON.stringify(err));
					}
					found = false;
					return;
				}
				const dataKey = JSON.stringify(device.data);
				window.selected_devices = [ dataKey ];
				window.found_devices = {};
				window.found_devices[dataKey] = device;
				var $foundElems = $(idPrefix + '.foundAnimation');
				$foundElems.show();
				setTimeout(function () {
					$foundElems.addClass('fadeOut');
					setTimeout(nextView, 400);
				}, 500);
			});
		}
	});
</script>

<style>
	#found {
		z-index: 2;
		position: absolute;
		top: 20vh;
		left: 38vw;
		font-size: 30vh;
		color: #080;
		opacity: 1;
	}

	#foundBackground {
		z-index: 1;
		top: 0;
		bottom: 0;
		left: 0;
		right: 0;
		position: absolute;
		background-color: #FFF;
		opacity: 0.8;
	}

	.fadeOut {
		-webkit-transition: all 0.5s ease-in-out;
		-moz-transition: all 0.5s ease-in-out;
		-ms-transition: all 0.5s ease-in-out;
		-o-transition: all 0.5s ease-in-out;
		transition: all 0.5s ease-in-out;
		opacity: 0 !important;
	}
</style>